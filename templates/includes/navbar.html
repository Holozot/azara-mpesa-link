{% load static %}

<header class="section-header">

    <section class="header-main border-bottom">
        <div class="container">
            <div class="row align-items-center">
                
                <div class="col-lg-auto col-md-auto col-12 text-center text-md-left mb-2 mb-md-0">
                    <a href="{% url 'store:home' %}" class="brand-wrap">
                        <img class="logo" src="{% static 'images/azaralogo_header.png' %}" alt="Azara Logo" style="max-height: 90px; width: auto;">
                    </a>
                </div>
                
                <div class="col-lg-auto col-md-auto col-12 text-center text-md-left">
                    <div class="d-flex align-items-center justify-content-center justify-content-md-start">
                        
                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn btn-primary dropdown-toggle px-3" data-toggle="dropdown"> 
                                <i class="fa fa-bars"></i> Categories 
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="{% url 'store:store' %}">All Products</a>
                                <div class="dropdown-divider"></div>
                                {% for category in links %}
                                    <a class="dropdown-item" href="{{ category.get_url }}">{{ category.name }}</a>
                                {% endfor %}
                            </div>
                        </div>
                
                        <div class="dropdown d-inline-block ml-2">
                            <button type="button" class="btn btn-outline-primary dropdown-toggle px-3" data-toggle="dropdown"> 
                                Menu 
                            </button>
                            
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="{% url 'store:home' %}">Home</a>
                                <a class="dropdown-item" href="{% url 'store:store' %}">Shop</a>
                                
                                {% if user.is_authenticated %}
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="{% url 'dashboard' %}">Dashboard</a>
                                    <a class="dropdown-item" href="{% url 'store:my_orders' %}">My Orders</a>
                                {% endif %}
                            </div>
                        </div>

                    </div>
                </div>
                
                <!-- RIGHT ALIGNED WIDGETS SECTION -->
                <div class="col-lg col-md col-12 text-lg-right text-center mt-3 mt-md-0">
                    <div class="widgets-wrap d-flex justify-content-center justify-content-lg-end align-items-center">
                        
                        <!-- The opening <a> tag now correctly wraps the icon content -->
                        <a href="{% url 'carts:cart' %}" class="widget-header mr-3 text-dark">
                            <div class="icon">
                                <i class="icon-sm rounded-circle border fa fa-shopping-cart"></i>
                                <span class="notify" style="background-color: var(--azara-primary);">{{ cart_count }}</span>
                            </div>
                        </a> <!-- FIX: The closing </a> tag is correctly placed here -->

                        {% if user.is_authenticated %}
                            <!-- Wrap greeting and logout in a div for better alignment control if needed, 
                                but the span and button structure already works well within the flex container. -->
                            <span class="text-muted small mr-3" style="white-space: nowrap; font-weight: 500;">
                                Welcome, <b style="color: var(--azara-primary);">{{ user.first_name }}</b>
                            </span>
                            
                            <a href="{% url 'logout' %}" class="btn btn-sm btn-light border px-3" style="color: var(--azara-primary); font-weight: 600;">
                                <i class="fa fa-sign-out-alt"></i> Logout
                            </a>

                        {% else %}
                            <div class="widget-header mr-2 d-inline-block">
                                <a href="{% url 'login' %}" class="btn btn-light px-4" style="color: var(--azara-primary); font-weight: 600;">Log In</a>
                            </div>
                            <div class="widget-header d-inline-block">
                                <a href="{% url 'register' %}" class="btn btn-primary px-4 text-white">Sign Up</a>
                            </div>
                        {% endif %}

                    </div> 
                </div> 
                <!-- END RIGHT ALIGNED WIDGETS SECTION -->
            </div> 
        </div> 
    </section>

    <section class="header-main border-bottom bg-light">
        <div class="container py-2">
            <div class="row"> 
                <div class="col-12">
                    <form action="{% url 'store:search' %}" class="search" method="GET">
                        <div class="input-group input-group-lg">
                            <input type="search" class="form-control" name="keyword" placeholder="Search products, brands, or categories...">
                            <div class="input-group-append">
                                <button class="btn btn-primary px-4" type="submit">
                                    <i class="fa fa-search"></i> Search
                                </button>
                            </div>
                        </div>
                    </form> 
                </div> 
            </div> 
        </div> 
    </section>
    
</header>