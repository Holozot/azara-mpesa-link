{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="section-content padding-y bg">
<div class="container">

<div class="card">
    <div class="row no-gutters">
        <aside class="col-md-6">
            <article class="gallery-wrap"> 
                <div class="img-big-wrap">
                   <a href="#"><img src="{{ single_product.image.url }}"></a>
                </div> 
            </article> 
        </aside>
        <main class="col-md-6 border-left">
            <article class="content-body">
            
            <h2 class="title">{{ single_product.name }}</h2>
            
            <div class="mb-3"> 
                <var class="price h4">
                    KES <span id="product_price">
                        {% if variants %}
                            {{ variants.0.price }} {% else %}
                            0.00
                        {% endif %}
                    </span>
                </var> 
            </div> 

            <hr>
            
            <form action="{% url 'add_cart' single_product.id %}" method="POST">
                {% csrf_token %}
                
                {% if variants %}
                <div class="row">
                    <div class="item-option-select">
                        <h6>Select Size</h6>
                        <div class="btn-group btn-group-toggle">
                            
                            {% for variant in single_product.variants.all %}
                            
                            <label class="btn btn-size-selector {% if forloop.first %}active-pink{% endif %}" 
                                onclick="selectSize(this, '{{ variant.price }}')"
                                style="margin-right: 5px; border-radius: 5px; cursor: pointer;">
                                
                                <input type="radio" name="variant_id" value="{{ variant.id }}" 
                                    {% if forloop.first %}checked{% endif %}
                                    style="display:none;" required>
                                
                                {{ variant.size_ml_g }}
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                </div> 
                {% endif %}
                
                <div class="row mb-3">
                    <div class="col-6">
                        <h6 class="mb-2">Quantity</h6>
                        <select name="quantity" class="form-control" style="width: 80px;">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>

                <hr>
                
                {% if single_product.available %}
                    <button type="submit" class="btn btn-primary"> 
                        <span class="text">Add to cart</span> 
                        <i class="fas fa-shopping-cart"></i> 
                    </button>
                {% else %}
                     <h5 class="text-danger">Out of Stock</h5>
                {% endif %}
            
            </form>
            </article> 
        </main> 
    </div> 
</div> 
<br>

<div class="row">
    <div class="col-12">
        <header class="section-heading">
            <h3>Product Description</h3>  
        </header>

        <article class="box mb-3 bg-white p-4 shadow-sm rounded">
            <p>
                {{ single_product.description }}
            </p>
        </article>
    </div> 
</div> 

</div>
</section>

<script>
    function selectSize(labelElement, price) {
        // 1. UPDATE PRICE TEXT
        document.getElementById('product_price').innerText = price;

        // 2. CHECK THE HIDDEN RADIO BUTTON
        var input = labelElement.querySelector('input');
        input.checked = true;

        // 3. UPDATE VISUALS (PINK BUTTONS)
        var allLabels = document.querySelectorAll('.btn-size-selector');
        
        // Remove pink class from ALL
        allLabels.forEach(function(lbl) {
            lbl.classList.remove('active-pink');
        });

        // Add pink class ONLY to the clicked label
        labelElement.classList.add('active-pink');
    }
</script>

{% endblock %}